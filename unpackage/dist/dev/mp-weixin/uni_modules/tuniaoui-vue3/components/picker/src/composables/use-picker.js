"use strict";const i=require("../../../../../../common/vendor.js"),w=require("../../../../constants/event.js"),b=require("../../../../utils/is-empty.js");require("../../../../libs/lodash/_baseToString.js");const T=require("../../../../utils/error.js"),V=require("../../../../utils/clone-deep.js"),C=t=>{const{emit:s}=i.getCurrentInstance(),D=i.ref(!1),x=i.ref(!0);i.watch(()=>t.open,e=>{D.value=e});const y=()=>{s("update:open",!1)},A=()=>{y(),k(t.modelValue),s("close")};let o="signle";const g=e=>{if(i.isObject(e)){const l=V.cloneDeep(e);return Object.prototype.hasOwnProperty.call(l,t.childrenKey)&&delete l[t.childrenKey],{label:e[t.labelKey],value:e[t.valueKey],originalData:l}}else return{label:e,value:e,originalData:e}},d=(e,l=1,u=[])=>{a.value.length<l&&a.value.push(...Array.from({length:l-a.value.length},()=>[])),a.value[l-1]=[...e.map(r=>g(r))];let n=0;u.length&&(n=a.value[l-1].findIndex(r=>r.value===u[l-1]),n=~n?n:0),e[n]&&Object.prototype.hasOwnProperty.call(e[n],t.childrenKey)&&d(e[n][t.childrenKey],l+1,u)},a=i.ref([]),c=i.ref([]),_=()=>{let e=[];t.modelValue===void 0||!t.modelValue&&["multiple","cascade"].includes(o)||i.isArray(t.modelValue)&&!t.modelValue.length?e=Array.from({length:a.value.length},()=>0):i.isArray(t.modelValue)?e=a.value.map((l,u)=>{let n=0;return t.modelValue[u]?n=l.findIndex(r=>r.value===t.modelValue[u]):n=0,~n?n:0}):e=a.value.map((l,u)=>{const n=a.value[u].findIndex(r=>r.value===t.modelValue);return n===-1?0:n}),c.value=e},K=()=>{const{data:e}=t;e&&(i.isArray(e)||T.throwError("TnPicker","picker选择器数据不正确，请传递数组格式的数据"),e.length!==0&&(i.isArray(e[0])?(o="multiple",a.value=e.reduce((l,u)=>(l.push(u.map(n=>g(n))),l),[])):!i.isArray(e[0])&&i.isObject(e[0])&&Object.prototype.hasOwnProperty.call(e[0],t.childrenKey)?(o="cascade",d(e,1,t.modelValue)):(o="signle",a.value=[e.map(l=>g(l))]),i.nextTick$1(()=>{_()})))};i.watch(()=>t.data,()=>{K()},{immediate:!0});const E=()=>{if(o==="signle"&&!i.isArray(t.data[0]))return a.value[0][c.value[0]].value;{const e=V.cloneDeep(c.value);return e.splice(a.value.length),e.map((l,u)=>{var n;return b.isEmptyVariableInDefault((n=a.value[u][l])==null?void 0:n.value,0)})}},I=()=>{if(o==="signle"&&!i.isArray(t.data[0]))return a.value[0][c.value[0]].originalData;{const e=V.cloneDeep(c.value);return e.splice(a.value.length),e.map((l,u)=>{var n;return b.isEmptyVariableInDefault((n=a.value[u][l])==null?void 0:n.originalData,void 0)})}},k=e=>{o==="cascade"&&d(t.data,1,e),i.nextTick$1(()=>{_()})};let m=!1;i.watch(()=>t.modelValue,e=>{if(m){m=!1;return}k(e)},{deep:!0});let f=null,P=!1;return{openPopup:D,showPicker:x,pickerData:a,currentPickerIndex:c,closePopupEvent:A,pickerViewChangeEvent:e=>{if(P)return;f=setTimeout(()=>{P=!1,f&&clearTimeout(f),f=null},300),P=!0;let l=c.value.findIndex((r,v)=>r!==e.detail.value[v]);if(l=~l?l:0,c.value=e.detail.value,o==="cascade"){let r=t.data;for(let h=0;h<l;h++)r=r[c.value[h]][t.childrenKey];const v=c.value[l];a.value.splice(l+1),r[v]&&Object.prototype.hasOwnProperty.call(r[v],t.childrenKey)&&(d(r[v][t.childrenKey],l+2),c.value=a.value.map((h,O)=>O<=l?c.value[O]:0))}m=!0;const u=E(),n=I();s(w.CHANGE_EVENT,u,l,n)},confirmEvent:()=>{const e=E(),l=I();m=!0,s(w.UPDATE_MODEL_EVENT,e),i.nextTick$1(()=>{s("confirm",e,l)}),y()},cancelEvent:()=>{k(t.modelValue),s("cancel"),y()},initDefaultPickerIndex:_,resetPickerIndexWithPosition:(e,l)=>{c.value=c.value.map((u,n)=>n>=e&&(!l||n<=l)?0:u)}}};exports.usePicker=C;
//# sourceMappingURL=../../../../../../../.sourcemap/mp-weixin/uni_modules/tuniaoui-vue3/components/picker/src/composables/use-picker.js.map
