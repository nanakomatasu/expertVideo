{"version":3,"file":"use-popup.js","sources":["uni_modules/tuniaoui-vue3/components/popup/src/composables/use-popup.ts"],"sourcesContent":["import { computed, getCurrentInstance, ref, watch } from 'vue'\nimport { UPDATE_MODEL_EVENT } from '../../../../constants'\n\nimport type { PopupProps } from '../popup'\n\nexport const usePopup = (props: PopupProps) => {\n  const { emit } = getCurrentInstance()!\n  const iosDevice = computed<boolean>(() => {\n    const systemInfo = uni.getSystemInfoSync()\n    return systemInfo.osName === 'ios' || systemInfo.osName === 'macos'\n  })\n\n  // 是否显示遮罩层\n  const showOverlay = ref(false)\n  // 是否显示弹框\n  const showPopup = ref(false)\n  const visiblePopup = ref(false)\n  let initPopupModelValue = false\n  watch(\n    () => props.modelValue,\n    (value) => {\n      if (value) {\n        visiblePopup.value = true\n        if (iosDevice.value) {\n          setTimeout(() => {\n            showPopup.value = true\n            if (props.overlay) showOverlay.value = true\n            initPopupModelValue && emit('open')\n          }, 0)\n        } else {\n          showPopup.value = true\n          if (props.overlay) showOverlay.value = true\n          initPopupModelValue && emit('open')\n        }\n      } else {\n        showPopup.value = false\n        showOverlay.value = false\n        setTimeout(() => {\n          visiblePopup.value = false\n        }, 250)\n        initPopupModelValue && emit('close')\n      }\n      initPopupModelValue = true\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  // 更新模态框的状态\n  const updateModelValue = (value: boolean) => {\n    emit(UPDATE_MODEL_EVENT, value)\n  }\n\n  // 点击关闭按钮\n  const onClickCloseBtn = () => {\n    updateModelValue(false)\n    emit('close')\n  }\n\n  // 点击遮罩层关闭模态框\n  const onClickOverlay = () => {\n    if (props.overlayCloseable) {\n      updateModelValue(false)\n      emit('close')\n      emit('overlay-click')\n    }\n  }\n\n  return {\n    iosDevice,\n    showOverlay,\n    showPopup,\n    visiblePopup,\n    updateModelValue,\n    onClickCloseBtn,\n    onClickOverlay,\n  }\n}\n"],"names":["usePopup","props","emit","getCurrentInstance","iosDevice","computed","systemInfo","uni","showOverlay","ref","showPopup","visiblePopup","initPopupModelValue","watch","value","updateModelValue","UPDATE_MODEL_EVENT"],"mappings":"+GAKaA,EAAYC,GAAsB,CACvC,KAAA,CAAE,KAAAC,GAASC,EAAAA,qBACXC,EAAYC,EAAAA,SAAkB,IAAM,CAClC,MAAAC,EAAaC,QAAI,oBACvB,OAAOD,EAAW,SAAW,OAASA,EAAW,SAAW,OAAA,CAC7D,EAGKE,EAAcC,MAAI,EAAK,EAEvBC,EAAYD,MAAI,EAAK,EACrBE,EAAeF,MAAI,EAAK,EAC9B,IAAIG,EAAsB,GAC1BC,EAAA,MACE,IAAMZ,EAAM,WACXa,GAAU,CACLA,GACFH,EAAa,MAAQ,GACjBP,EAAU,MACZ,WAAW,IAAM,CACfM,EAAU,MAAQ,GACdT,EAAM,UAASO,EAAY,MAAQ,IACvCI,GAAuBV,EAAK,MAAM,GACjC,CAAC,GAEJQ,EAAU,MAAQ,GACdT,EAAM,UAASO,EAAY,MAAQ,IACvCI,GAAuBV,EAAK,MAAM,KAGpCQ,EAAU,MAAQ,GAClBF,EAAY,MAAQ,GACpB,WAAW,IAAM,CACfG,EAAa,MAAQ,IACpB,GAAG,EACNC,GAAuBV,EAAK,OAAO,GAEfU,EAAA,EACxB,EACA,CACE,UAAW,EACb,CAAA,EAII,MAAAG,EAAoBD,GAAmB,CAC3CZ,EAAKc,EAAAA,mBAAoBF,CAAK,CAAA,EAkBzB,MAAA,CACL,UAAAV,EACA,YAAAI,EACA,UAAAE,EACA,aAAAC,EACA,iBAAAI,EACA,gBApBsB,IAAM,CAC5BA,EAAiB,EAAK,EACtBb,EAAK,OAAO,CAAA,EAmBZ,eAfqB,IAAM,CACvBD,EAAM,mBACRc,EAAiB,EAAK,EACtBb,EAAK,OAAO,EACZA,EAAK,eAAe,EACtB,CAUA,CAEJ"}