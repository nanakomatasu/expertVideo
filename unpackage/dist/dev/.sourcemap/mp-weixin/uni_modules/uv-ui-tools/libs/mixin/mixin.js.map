{"version":3,"file":"mixin.js","sources":["uni_modules/uv-ui-tools/libs/mixin/mixin.js"],"sourcesContent":["import * as index from '../function/index.js';\r\nimport * as test from '../function/test.js';\r\nimport route from '../util/route.js';\r\nimport debounce from '../function/debounce.js';\r\nimport throttle from '../function/throttle.js';\r\nexport default {\r\n\t// 定义每个组件都可能需要用到的外部样式以及类名\r\n\tprops: {\r\n\t\t// 每个组件都有的父组件传递的样式，可以为字符串或者对象形式\r\n\t\tcustomStyle: {\r\n\t\t\ttype: [Object, String],\r\n\t\t\tdefault: () => ({})\r\n\t\t},\r\n\t\tcustomClass: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\t// 跳转的页面路径\r\n\t\turl: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: ''\r\n\t\t},\r\n\t\t// 页面跳转的类型\r\n\t\tlinkType: {\r\n\t\t\ttype: String,\r\n\t\t\tdefault: 'navigateTo'\r\n\t\t}\r\n\t},\r\n\tdata() {\r\n\t\treturn {}\r\n\t},\r\n\tonLoad() {\r\n\t\t// getRect挂载到$uv上，因为这方法需要使用in(this)，所以无法把它独立成一个单独的文件导出\r\n\t\tthis.$uv.getRect = this.$uvGetRect\r\n\t},\r\n\tcreated() {\r\n\t\t// 组件当中，只有created声明周期，为了能在组件使用，故也在created中将方法挂载到$uv\r\n\t\tthis.$uv.getRect = this.$uvGetRect\r\n\t},\r\n\tcomputed: {\r\n\t\t$uv() {\r\n\t\t\treturn {\r\n\t\t\t\t...index,\r\n\t\t\t\ttest,\r\n\t\t\t\troute,\r\n\t\t\t\tdebounce,\r\n\t\t\t\tthrottle,\r\n\t\t\t\tunit: uni?.$uv?.config?.unit\r\n\t\t\t}\r\n\t\t},\r\n\t\t/**\r\n\t\t * 生成bem规则类名\r\n\t\t * 由于微信小程序，H5，nvue之间绑定class的差异，无法通过:class=\"[bem()]\"的形式进行同用\r\n\t\t * 故采用如下折中做法，最后返回的是数组（一般平台）或字符串（支付宝和字节跳动平台），类似['a', 'b', 'c']或'a b c'的形式\r\n\t\t * @param {String} name 组件名称\r\n\t\t * @param {Array} fixed 一直会存在的类名\r\n\t\t * @param {Array} change 会根据变量值为true或者false而出现或者隐藏的类名\r\n\t\t * @returns {Array|string}\r\n\t\t */\r\n\t\tbem() {\r\n\t\t\treturn function(name, fixed, change) {\r\n\t\t\t\t// 类名前缀\r\n\t\t\t\tconst prefix = `uv-${name}--`\r\n\t\t\t\tconst classes = {}\r\n\t\t\t\tif (fixed) {\r\n\t\t\t\t\tfixed.map((item) => {\r\n\t\t\t\t\t\t// 这里的类名，会一直存在\r\n\t\t\t\t\t\tclasses[prefix + this[item]] = true\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\tif (change) {\r\n\t\t\t\t\tchange.map((item) => {\r\n\t\t\t\t\t\t// 这里的类名，会根据this[item]的值为true或者false，而进行添加或者移除某一个类\r\n\t\t\t\t\t\tthis[item] ? (classes[prefix + item] = this[item]) : (delete classes[prefix + item])\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treturn Object.keys(classes)\r\n\t\t\t\t\t// 支付宝，头条小程序无法动态绑定一个数组类名，否则解析出来的结果会带有\",\"，而导致失效\r\n\t\t\t\t\t// #ifdef MP-ALIPAY || MP-TOUTIAO || MP-LARK || MP-BAIDU\r\n\t\t\t\t\t.join(' ')\r\n\t\t\t\t// #endif\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\t// 跳转某一个页面\r\n\t\topenPage(urlKey = 'url') {\r\n\t\t\tconst url = this[urlKey]\r\n\t\t\tif (url) {\r\n\t\t\t\t// 执行类似uni.navigateTo的方法\r\n\t\t\t\tuni[this.linkType]({\r\n\t\t\t\t\turl\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 查询节点信息\r\n\t\t// 目前此方法在支付宝小程序中无法获取组件跟接点的尺寸，为支付宝的bug(2020-07-21)\r\n\t\t// 解决办法为在组件根部再套一个没有任何作用的view元素\r\n\t\t$uvGetRect(selector, all) {\r\n\t\t\treturn new Promise((resolve) => {\r\n\t\t\t\tuni.createSelectorQuery()\r\n\t\t\t\t\t.in(this)[all ? 'selectAll' : 'select'](selector)\r\n\t\t\t\t\t.boundingClientRect((rect) => {\r\n\t\t\t\t\t\tif (all && Array.isArray(rect) && rect.length) {\r\n\t\t\t\t\t\t\tresolve(rect)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!all && rect) {\r\n\t\t\t\t\t\t\tresolve(rect)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec()\r\n\t\t\t})\r\n\t\t},\r\n\t\tgetParentData(parentName = '') {\r\n\t\t\t// 避免在created中去定义parent变量\r\n\t\t\tif (!this.parent) this.parent = {}\r\n\t\t\t// 这里的本质原理是，通过获取父组件实例(也即类似uv-radio的父组件uv-radio-group的this)\r\n\t\t\t// 将父组件this中对应的参数，赋值给本组件(uv-radio的this)的parentData对象中对应的属性\r\n\t\t\t// 之所以需要这么做，是因为所有端中，头条小程序不支持通过this.parent.xxx去监听父组件参数的变化\r\n\t\t\t// 此处并不会自动更新子组件的数据，而是依赖父组件uv-radio-group去监听data的变化，手动调用更新子组件的方法去重新获取\r\n\t\t\tthis.parent = this.$uv.$parent.call(this, parentName)\r\n\t\t\tif (this.parent.children) {\r\n\t\t\t\t// 如果父组件的children不存在本组件的实例，才将本实例添加到父组件的children中\r\n\t\t\t\tthis.parent.children.indexOf(this) === -1 && this.parent.children.push(this)\r\n\t\t\t}\r\n\t\t\tif (this.parent && this.parentData) {\r\n\t\t\t\t// 历遍parentData中的属性，将parent中的同名属性赋值给parentData\r\n\t\t\t\tObject.keys(this.parentData).map((key) => {\r\n\t\t\t\t\tthis.parentData[key] = this.parent[key]\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 阻止事件冒泡\r\n\t\tpreventEvent(e) {\r\n\t\t\te && typeof(e.stopPropagation) === 'function' && e.stopPropagation()\r\n\t\t},\r\n\t\t// 空操作\r\n\t\tnoop(e) {\r\n\t\t\tthis.preventEvent(e)\r\n\t\t}\r\n\t},\r\n\tonReachBottom() {\r\n\t\tuni.$emit('uvOnReachBottom')\r\n\t},\r\n\tbeforeDestroy() {\r\n\t\t// 判断当前页面是否存在parent和chldren，一般在checkbox和checkbox-group父子联动的场景会有此情况\r\n\t\t// 组件销毁时，移除子组件在父组件children数组中的实例，释放资源，避免数据混乱\r\n\t\tif (this.parent && test.array(this.parent.children)) {\r\n\t\t\t// 组件销毁时，移除父组件中的children数组中对应的实例\r\n\t\t\tconst childrenList = this.parent.children\r\n\t\t\tchildrenList.map((child, index) => {\r\n\t\t\t\t// 如果相等，则移除\r\n\t\t\t\tif (child === this) {\r\n\t\t\t\t\tchildrenList.splice(index, 1)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t},\r\n\t// 兼容vue3\r\n\tunmounted() {\r\n\t\tif (this.parent && test.array(this.parent.children)) {\r\n\t\t\t// 组件销毁时，移除父组件中的children数组中对应的实例\r\n\t\t\tconst childrenList = this.parent.children\r\n\t\t\tchildrenList.map((child, index) => {\r\n\t\t\t\t// 如果相等，则移除\r\n\t\t\t\tif (child === this) {\r\n\t\t\t\t\tchildrenList.splice(index, 1)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}"],"names":["mixin","index","test","route","debounce","throttle","uni","name","fixed","change","prefix","classes","item","urlKey","url","selector","all","resolve","rect","parentName","key","e","test.array","childrenList","child"],"mappings":"wOAKeA,EAAA,CAEd,MAAO,CAEN,YAAa,CACZ,KAAM,CAAC,OAAQ,MAAM,EACrB,QAAS,KAAO,CAAA,EAChB,EACD,YAAa,CACZ,KAAM,OACN,QAAS,EACT,EAED,IAAK,CACJ,KAAM,OACN,QAAS,EACT,EAED,SAAU,CACT,KAAM,OACN,QAAS,YACT,CACD,EACD,MAAO,CACN,MAAO,CAAE,CACT,EACD,QAAS,CAER,KAAK,IAAI,QAAU,KAAK,UACxB,EACD,SAAU,CAET,KAAK,IAAI,QAAU,KAAK,UACxB,EACD,SAAU,CACT,KAAM,WACL,MAAO,CACN,GAAGC,EAAK,MACZ,KAAIC,EAAI,KACR,MAAIC,EAAK,MACT,SAAIC,EAAQ,SACZ,SAAIC,EAAQ,SACR,MAAMC,GAAAA,GAAAA,EAAAA,EAAG,QAAHA,YAAAA,EAAK,MAALA,YAAAA,EAAU,SAAVA,YAAAA,EAAkB,IACxB,CACD,EAUD,KAAM,CACL,OAAO,SAASC,EAAMC,EAAOC,EAAQ,CAEpC,MAAMC,EAAS,MAAMH,CAAI,KACnBI,EAAU,CAAE,EAClB,OAAIH,GACHA,EAAM,IAAKI,GAAS,CAEnBD,EAAQD,EAAS,KAAKE,CAAI,CAAC,EAAI,EACrC,CAAM,EAEEH,GACHA,EAAO,IAAKG,GAAS,CAEpB,KAAKA,CAAI,EAAKD,EAAQD,EAASE,CAAI,EAAI,KAAKA,CAAI,EAAM,OAAOD,EAAQD,EAASE,CAAI,CACxF,CAAM,EAEK,OAAO,KAAKD,CAAO,CAK1B,CACD,CACD,EACD,QAAS,CAER,SAASE,EAAS,MAAO,CACxB,MAAMC,EAAM,KAAKD,CAAM,EACnBC,GAEHR,QAAI,KAAK,QAAQ,EAAE,CAClB,IAAAQ,CACL,CAAK,CAEF,EAID,WAAWC,EAAUC,EAAK,CACzB,OAAO,IAAI,QAASC,GAAY,CAC/BX,EAAAA,MAAI,oBAAqB,EACvB,GAAG,IAAI,EAAEU,EAAM,YAAc,QAAQ,EAAED,CAAQ,EAC/C,mBAAoBG,GAAS,CACzBF,GAAO,MAAM,QAAQE,CAAI,GAAKA,EAAK,QACtCD,EAAQC,CAAI,EAET,CAACF,GAAOE,GACXD,EAAQC,CAAI,CAEnB,CAAM,EACA,KAAM,CACZ,CAAI,CACD,EACD,cAAcC,EAAa,GAAI,CAEzB,KAAK,SAAQ,KAAK,OAAS,CAAE,GAKlC,KAAK,OAAS,KAAK,IAAI,QAAQ,KAAK,KAAMA,CAAU,EAChD,KAAK,OAAO,UAEf,KAAK,OAAO,SAAS,QAAQ,IAAI,IAAM,IAAM,KAAK,OAAO,SAAS,KAAK,IAAI,EAExE,KAAK,QAAU,KAAK,YAEvB,OAAO,KAAK,KAAK,UAAU,EAAE,IAAKC,GAAQ,CACzC,KAAK,WAAWA,CAAG,EAAI,KAAK,OAAOA,CAAG,CAC3C,CAAK,CAEF,EAED,aAAaC,EAAG,CACfA,GAAK,OAAOA,EAAE,iBAAqB,YAAcA,EAAE,gBAAiB,CACpE,EAED,KAAKA,EAAG,CACP,KAAK,aAAaA,CAAC,CACnB,CACD,EACD,eAAgB,CACff,EAAG,MAAC,MAAM,iBAAiB,CAC3B,EACD,eAAgB,CAGf,GAAI,KAAK,QAAUgB,EAAAA,MAAW,KAAK,OAAO,QAAQ,EAAG,CAEpD,MAAMC,EAAe,KAAK,OAAO,SACjCA,EAAa,IAAI,CAACC,EAAOvB,IAAU,CAE9BuB,IAAU,MACbD,EAAa,OAAOtB,EAAO,CAAC,CAEjC,CAAI,CACD,CACD,EAED,WAAY,CACX,GAAI,KAAK,QAAUqB,EAAAA,MAAW,KAAK,OAAO,QAAQ,EAAG,CAEpD,MAAMC,EAAe,KAAK,OAAO,SACjCA,EAAa,IAAI,CAACC,EAAOvB,IAAU,CAE9BuB,IAAU,MACbD,EAAa,OAAOtB,EAAO,CAAC,CAEjC,CAAI,CACD,CACD,CACF"}