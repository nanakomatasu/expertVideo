{"version":3,"file":"mergeConfig.js","sources":["uni_modules/uv-ui-tools/libs/luch-request/core/mergeConfig.js"],"sourcesContent":["import {deepMerge, isUndefined} from '../utils'\r\n\r\n/**\r\n * 合并局部配置优先的配置，如果局部有该配置项则用局部，如果全局有该配置项则用全局\r\n * @param {Array} keys - 配置项\r\n * @param {Object} globalsConfig - 当前的全局配置\r\n * @param {Object} config2 - 局部配置\r\n * @return {{}}\r\n */\r\nconst mergeKeys = (keys, globalsConfig, config2) => {\r\n  let config = {}\r\n  keys.forEach(prop => {\r\n    if (!isUndefined(config2[prop])) {\r\n      config[prop] = config2[prop]\r\n    } else if (!isUndefined(globalsConfig[prop])) {\r\n      config[prop] = globalsConfig[prop]\r\n    }\r\n  })\r\n  return config\r\n}\r\n/**\r\n *\r\n * @param globalsConfig - 当前实例的全局配置\r\n * @param config2 - 当前的局部配置\r\n * @return - 合并后的配置\r\n */\r\nexport default (globalsConfig, config2 = {}) => {\r\n  const method = config2.method || globalsConfig.method || 'GET'\r\n  let config = {\r\n    baseURL: config2.baseURL || globalsConfig.baseURL || '',\r\n    method: method,\r\n    url: config2.url || '',\r\n    params: config2.params || {},\r\n    custom: {...(globalsConfig.custom || {}), ...(config2.custom || {})},\r\n    header: deepMerge(globalsConfig.header || {}, config2.header || {})\r\n  }\r\n  const defaultToConfig2Keys = ['getTask', 'validateStatus', 'paramsSerializer', 'forcedJSONParsing']\r\n  config = {...config, ...mergeKeys(defaultToConfig2Keys, globalsConfig, config2)}\r\n\r\n  // eslint-disable-next-line no-empty\r\n  if (method === 'DOWNLOAD') {\r\n    const downloadKeys = [\r\n      // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n      'timeout',\r\n      // #endif\r\n      // #ifdef MP\r\n      'filePath',\r\n      // #endif\r\n    ]\r\n    config = {...config, ...mergeKeys(downloadKeys, globalsConfig, config2)}\r\n  } else if (method === 'UPLOAD') {\r\n    delete config.header['content-type']\r\n    delete config.header['Content-Type']\r\n    const uploadKeys = [\r\n      // #ifdef APP-PLUS || H5\r\n      'files',\r\n      // #endif\r\n      // #ifdef MP-ALIPAY\r\n      'fileType',\r\n      // #endif\r\n      // #ifdef H5\r\n      'file',\r\n      // #endif\r\n      'filePath',\r\n      'name',\r\n      // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n      'timeout',\r\n      // #endif\r\n      'formData',\r\n    ]\r\n    uploadKeys.forEach(prop => {\r\n      if (!isUndefined(config2[prop])) {\r\n        config[prop] = config2[prop]\r\n      }\r\n    })\r\n    // #ifdef H5 || APP-PLUS || MP-WEIXIN || MP-ALIPAY || MP-TOUTIAO || MP-KUAISHOU\r\n    if (isUndefined(config.timeout) && !isUndefined(globalsConfig.timeout)) {\r\n      config['timeout'] = globalsConfig['timeout']\r\n    }\r\n    // #endif\r\n  } else {\r\n    const defaultsKeys = [\r\n      'data',\r\n      // #ifdef H5 || APP-PLUS || MP-ALIPAY || MP-WEIXIN\r\n      'timeout',\r\n      // #endif\r\n      'dataType',\r\n      // #ifndef MP-ALIPAY\r\n      'responseType',\r\n      // #endif\r\n      // #ifdef APP-PLUS\r\n      'sslVerify',\r\n      // #endif\r\n      // #ifdef H5\r\n      'withCredentials',\r\n      // #endif\r\n      // #ifdef APP-PLUS\r\n      'firstIpv4',\r\n      // #endif\r\n      // #ifdef MP-WEIXIN\r\n      'enableHttp2',\r\n      'enableQuic',\r\n      // #endif\r\n      // #ifdef MP-TOUTIAO || MP-WEIXIN\r\n      'enableCache',\r\n      // #endif\r\n      // #ifdef MP-WEIXIN\r\n      'enableHttpDNS',\r\n      'httpDNSServiceId',\r\n      'enableChunked',\r\n      'forceCellularNetwork',\r\n      // #endif\r\n      // #ifdef MP-ALIPAY\r\n      'enableCookie',\r\n      // #endif\r\n      // #ifdef MP-BAIDU\r\n      'cloudCache',\r\n      'defer'\r\n      // #endif\r\n\r\n    ]\r\n    config = {...config, ...mergeKeys(defaultsKeys, globalsConfig, config2)}\r\n  }\r\n\r\n  return config\r\n}\r\n"],"names":["mergeKeys","keys","globalsConfig","config2","config","prop","isUndefined","mergeConfig","method","deepMerge"],"mappings":"4CASMA,EAAY,CAACC,EAAMC,EAAeC,IAAY,CAClD,IAAIC,EAAS,CAAE,EACf,OAAAH,EAAK,QAAQI,GAAQ,CACdC,EAAW,YAACH,EAAQE,CAAI,CAAC,EAElBC,EAAW,YAACJ,EAAcG,CAAI,CAAC,IACzCD,EAAOC,CAAI,EAAIH,EAAcG,CAAI,GAFjCD,EAAOC,CAAI,EAAIF,EAAQE,CAAI,CAIjC,CAAG,EACMD,CACT,EAOAG,EAAe,CAACL,EAAeC,EAAU,KAAO,CAC9C,MAAMK,EAASL,EAAQ,QAAUD,EAAc,QAAU,MACzD,IAAIE,EAAS,CACX,QAASD,EAAQ,SAAWD,EAAc,SAAW,GACrD,OAAQM,EACR,IAAKL,EAAQ,KAAO,GACpB,OAAQA,EAAQ,QAAU,CAAE,EAC5B,OAAQ,CAAC,GAAID,EAAc,QAAU,CAAE,EAAG,GAAIC,EAAQ,QAAU,EAAI,EACpE,OAAQM,EAAS,UAACP,EAAc,QAAU,CAAA,EAAIC,EAAQ,QAAU,EAAE,CACnE,EAED,OAAAC,EAAS,CAAC,GAAGA,EAAQ,GAAGJ,EADK,CAAC,UAAW,iBAAkB,mBAAoB,mBAAmB,EAC1CE,EAAeC,CAAO,CAAC,EAG3EK,IAAW,WASbJ,EAAS,CAAC,GAAGA,EAAQ,GAAGJ,EARH,CAEnB,UAGA,UAED,EAC+CE,EAAeC,CAAO,CAAC,EAC9DK,IAAW,UACpB,OAAOJ,EAAO,OAAO,cAAc,EACnC,OAAOA,EAAO,OAAO,cAAc,EAChB,CAUjB,WACA,OAEA,UAEA,UACD,EACU,QAAQC,GAAQ,CACpBC,EAAW,YAACH,EAAQE,CAAI,CAAC,IAC5BD,EAAOC,CAAI,EAAIF,EAAQE,CAAI,EAEnC,CAAK,EAEGC,EAAAA,YAAYF,EAAO,OAAO,GAAK,CAACE,cAAYJ,EAAc,OAAO,IACnEE,EAAO,QAAaF,EAAc,UA4CpCE,EAAS,CAAC,GAAGA,EAAQ,GAAGJ,EAxCH,CACnB,OAEA,UAEA,WAEA,eAYA,cACA,aAGA,cAGA,gBACA,mBACA,gBACA,sBAUD,EAC+CE,EAAeC,CAAO,CAAC,EAGlEC,CACT"}