{"version":3,"file":"editUserInfo.js","sources":["pages/edit/editUserInfo.vue","../../HbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcZWRpdFxlZGl0VXNlckluZm8udnVl"],"sourcesContent":["<template>\r\n\t<view class=\"navigation-bar navigation-bar-background\">\r\n\t\t<view class=\"navgation-bar-content text-color\">\r\n\t\t\t<view style=\"position: absolute; left: 32rpx; top: 11rpx;\"> <uv-icon name=\"arrow-left\" color=\"#fff\"\r\n\t\t\t\t\t@click=\"backPages\"></uv-icon></view>\r\n\t\t\t编辑资料\r\n\t\t</view>\r\n\t</view>\r\n\t<view class=\"edit-title\">\r\n\t\t<P style=\"font-size: 32rpx; color: #15191B;\">完善资料</P>\r\n\t\t<p style=\"font-size: 24rpx; color: #4C4C4C; margin-top: 8rpx;\">让大家更好的认识你~</p>\r\n\t</view>\r\n\t<view class=\"edit-avatar\">\r\n\t\t<view class=\"change-avatar\" @click=\"uploadAvatar\"><uv-icon name=\"camera-fill\"\r\n\t\t\t\tstyle=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1;\"\r\n\t\t\t\tsize=\"50rpx\" color=\"#fff\"></uv-icon></view>\r\n\t\t<image :src=\"avatar\" mode=\"aspectFill\"></image>\r\n\t</view>\r\n\t<view class=\"userinfo-content center-box\">\r\n\t\t<view class=\"user-nick content-item\">\r\n\t\t\t<view class=\"content-item-title\">昵称</view>\r\n\t\t\t<view class=\"content-item-main\">\r\n\t\t\t\t<input type=\"text\" v-model=\"nick\" placeholder=\"请输入昵称\" />\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- \t\t<view class=\"user-gender content-item\">\r\n\t\t\t<view class=\"content-item-title\">性别</view>\r\n\t\t\t<view class=\"content-item-main\" style=\"display: flex; justify-content: space-between;\"\r\n\t\t\t\t@click=\"openGenderPicker\">{{pickerValue}}<uv-icon name=\"arrow-down-fill\"></uv-icon></view>\r\n\t\t</view> -->\r\n\t\t<view class=\"user-region content-item\">\r\n\t\t\t<view class=\"content-item-title\">地区</view>\r\n\t\t\t<view class=\"content-item-main\" style=\"display: flex; justify-content: space-between;\" @click=\"openRegion\">\r\n\t\t\t\t{{regionValue[0]}} {{regionValue[1]}} {{regionValue[2]}}<uv-icon name=\"arrow-down-fill\"></uv-icon>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- \t\t<view class=\"user-invite-id content-item\">\r\n\t\t\t<view class=\"content-item-title\">推荐ID</view>\r\n\t\t\t<view class=\"content-item-main\">\r\n\t\t\t\t<input type=\"text\" v-model=\"inviteCode\" placeholder=\"请输入推荐ID\" />\r\n\t\t\t</view>\r\n\t\t</view> -->\r\n\t</view>\r\n\t<view class=\"save-btn\" @click=\"editUserInfo\">\r\n\t\t完成编辑\r\n\t</view>\r\n\t<tn-region-picker v-model=\"regionValue\" v-model:open=\"openRegionPicker\" />\r\n\t<tn-picker v-model=\"pickerValue\" v-model:open=\"openPicker\" :data=\"pickerData\" />\r\n\t<view class=\"safe-box\"></view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref\r\n\t} from 'vue';\r\n\r\n\timport {\r\n\t\tonShow,\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app'\r\n\r\n\timport {\r\n\t\tSERVERTAPI\r\n\t} from '../../config';\r\n\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '../../store/user';\r\n\r\n\timport {\r\n\t\tchangeUserInfoApi,\r\n\t\tuserInfoApi,\r\n\t\ttelnumberApi\r\n\t} from '../../request/api';\r\n\r\n\tconst userStore = useUserStore()\r\n\r\n\tonLoad(() => {\r\n\t\tgetUserInfo()\r\n\t})\r\n\r\n\timport {\r\n\t\tupload\r\n\t} from '../../request/api'\r\n\r\n\tconst avatar = ref(\"\")\r\n\r\n\tconst openRegionPicker = ref(false)\r\n\r\n\tconst openPicker = ref(false)\r\n\r\n\tconst pickerValue = ref('男')\r\n\r\n\tconst regionValue = ref(['河南省', '郑州市', '金水区'])\r\n\r\n\t// const pickerData = ['男', '女']\r\n\r\n\tconst nick = ref(\"\")\r\n\r\n\tconst inviteCode = ref(\"\")\r\n\r\n\tconst uploadAvatar = () => {\r\n\t\tuni.chooseImage({\r\n\t\t\tcount: 1,\r\n\t\t\tsizeType: ['original', 'compressed'],\r\n\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconst tempFilePaths = res.tempFilePaths[0];\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: SERVERTAPI + upload,\r\n\t\t\t\t\tfilePath: tempFilePaths,\r\n\t\t\t\t\tname: 'file',\r\n\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t'uid': userStore.uid,\r\n\t\t\t\t\t\t'token': userStore.token\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (uploadRes) => {\r\n\t\t\t\t\t\tconst res = JSON.parse(uploadRes.data)\r\n\t\t\t\t\t\tif (res.code != 1) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\ttitle: res.info\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\ttitle: '上传成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tavatar.value = res.data.urlImg\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tconst backPages = () => {\r\n\t\tuni.navigateBack()\r\n\t}\r\n\r\n\tconst openRegion = () => {\r\n\t\topenRegionPicker.value = true\r\n\t}\r\n\r\n\tconst openGenderPicker = () => {\r\n\t\topenPicker.value = true\r\n\t}\r\n\r\n\tconst editUserInfo = () => {\r\n\t\tchangeUserInfoApi({\r\n\t\t\tuid: userStore.uid,\r\n\t\t\ttoken: userStore.token,\r\n\t\t\tnickname: nick.value,\r\n\t\t\theadimg: avatar.value,\r\n\t\t\tregion_province: regionValue.value[0],\r\n\t\t\tregion_city: regionValue.value[1],\r\n\t\t\tregion_area: regionValue.value[2]\r\n\t\t}).then(res => {\r\n\t\t\tif (res.code == 1) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\ttitle: '修改成功'\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t}, 500)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst getUserInfo = () => {\r\n\t\tuserInfoApi({\r\n\t\t\tuid: userStore.uid,\r\n\t\t\ttoken: userStore.token\r\n\t\t}).then(res => {\r\n\t\t\tnick.value = res.data.nickname\r\n\t\t\tavatar.value = res.data.headimg\r\n\t\t\tif (res.data.region_province != \"\") {\r\n\t\t\t\tregionValue.value[0] = res.data.region_province\r\n\t\t\t\tregionValue.value[1] = res.data.region_city\r\n\t\t\t\tregionValue.value[2] = res.data.region_area\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst getPhoneNumber = (e) => {\r\n\t\tif (e.detail.errMsg === 'getPhoneNumber:ok') {\r\n\t\t\tconst encryptedData = e.detail.encryptedData;\r\n\t\t\tconst iv = e.detail.iv;\r\n\t\t\tuni.login({\r\n\t\t\t\tsuccess: (loginRes) => {\r\n\t\t\t\t\tif (loginRes.code) {\r\n\t\t\t\t\t\ttelnumberApi({\r\n\t\t\t\t\t\t\tuid:userStore.uid,\r\n\t\t\t\t\t\t\tcode:loginRes.code,\r\n\t\t\t\t\t\t\tencryptedData:encryptedData,\r\n\t\t\t\t\t\t\tiv:iv\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tphone.value = res.data\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 获取登录凭证失败\r\n\t\t\t\t\t\tconsole.error('获取登录凭证失败：', loginRes.errMsg);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '获取登录凭证失败，请稍后重试',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t// 登录失败\r\n\t\t\t\t\tconsole.error('登录失败：', err);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录失败，请检查网络',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// 用户拒绝授权\r\n\t\t\tconsole.log('用户拒绝授权获取手机号');\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '你拒绝了授权，无法获取手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\tpage {\r\n\t\tbackground: #fff;\r\n\t}\r\n\r\n\t.navigation-bar {\r\n\t\toverflow: hidden;\r\n\t\twidth: 100%;\r\n\t\theight: 196rpx;\r\n\r\n\t\t.navgation-bar-content {\r\n\t\t\tposition: relative;\r\n\t\t\tmargin-top: 88rpx;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 108rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\r\n\t\t.text-color {\r\n\t\t\tcolor: #fff;\r\n\t\t}\r\n\t}\r\n\r\n\t.edit-title {\r\n\t\twidth: calc(100% - 128rpx);\r\n\t\tmargin: 48rpx 0 0 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t}\r\n\r\n\t.edit-avatar {\r\n\t\tposition: relative;\r\n\t\twidth: 168rpx;\r\n\t\theight: 168rpx;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin: 48rpx 0 0 64rpx;\r\n\r\n\t\t.change-avatar {\r\n\t\t\tz-index: 1;\r\n\t\t\tposition: absolute;\r\n\t\t\tright: 0;\r\n\t\t\tbottom: 0;\r\n\t\t\twidth: 60rpx;\r\n\t\t\theight: 60rpx;\r\n\t\t\tbackground-color: #1a1a1a;\r\n\t\t\tborder-radius: 50%;\r\n\t\t\tborder: 5rpx solid #fff;\r\n\t\t}\r\n\r\n\t\timage {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t}\r\n\t}\r\n\r\n\t.userinfo-content {\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0 24rpx;\r\n\t\tmargin-top: 56rpx;\r\n\r\n\t\t.content-item {\r\n\t\t\twidth: 100%;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\t\t\talign-items: center;\r\n\t\t\tmargin-bottom: 32rpx;\r\n\r\n\t\t\t.content-item-title {\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\tcolor: #4C4C4C;\r\n\t\t\t}\r\n\r\n\t\t\t.content-item-main {\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tpadding: 24rpx;\r\n\t\t\t\twidth: 500rpx;\r\n\t\t\t\theight: 88rpx;\r\n\t\t\t\tbackground: #F6F6F6;\r\n\t\t\t\tborder-radius: 8rpx 8rpx 8rpx 8rpx;\r\n\t\t\t\t\r\n\t\t\t\tbutton {\r\n\t\t\t\t\tpadding: 0;\r\n\t\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\t\twidth: 500rpx;\r\n\t\t\t\t\theight: 88rpx;\r\n\t\t\t\t\tline-height: 88rpx;\r\n\t\t\t\t\tbackground: #F6F6F6;\r\n\t\t\t\t\tborder-radius: 8rpx 8rpx 8rpx 8rpx;\r\n\t\t\t\t\ttext-align: left;\r\n\t\t\t\t\tpadding-left: 24rpx;\r\n\t\t\t\t\tfont-size: 28rpx;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.content-item-input {}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.save-btn {\r\n\t\twidth: calc(100% - 128rpx);\r\n\t\tmargin: 48rpx 0 0 50%;\r\n\t\ttransform: translateX(-50%);\r\n\t\theight: 88rpx;\r\n\t\tbackground: linear-gradient(90deg, #FFA143 0%, #FAA82C 100%);\r\n\t\tborder-radius: 88rpx 88rpx 88rpx 88rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 88rpx;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #fff;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.safe-box {\r\n\t\twidth: 100%;\r\n\t\theight: 50rpx;\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/work/达人h5/pages/edit/editUserInfo.vue'\nwx.createPage(MiniProgramPage)"],"names":["userStore","useUserStore","onLoad","getUserInfo","avatar","ref","openRegionPicker","openPicker","pickerValue","regionValue","nick","uploadAvatar","uni","res","tempFilePaths","SERVERTAPI","upload","uploadRes","backPages","openRegion","editUserInfo","changeUserInfoApi","userInfoApi","MiniProgramPage"],"mappings":"2lBA2EC,MAAMA,EAAYC,EAAAA,aAAc,EAEhCC,EAAAA,OAAO,IAAM,CACZC,EAAa,CACf,CAAE,EAMD,MAAMC,EAASC,EAAG,IAAC,EAAE,EAEfC,EAAmBD,EAAG,IAAC,EAAK,EAE5BE,EAAaF,EAAG,IAAC,EAAK,EAEtBG,EAAcH,EAAG,IAAC,GAAG,EAErBI,EAAcJ,EAAAA,IAAI,CAAC,MAAO,MAAO,KAAK,CAAC,EAIvCK,EAAOL,EAAG,IAAC,EAAE,EAEAA,EAAAA,IAAI,EAAE,EAEzB,MAAMM,EAAe,IAAM,CAC1BC,EAAAA,MAAI,YAAY,CACf,MAAO,EACP,SAAU,CAAC,WAAY,YAAY,EACnC,WAAY,CAAC,QAAS,QAAQ,EAC9B,QAAUC,GAAQ,CACjB,MAAMC,EAAgBD,EAAI,cAAc,CAAC,EACzCD,EAAAA,MAAI,WAAW,CACd,IAAKG,EAAU,WAAGC,EAAM,OACxB,SAAUF,EACV,KAAM,OACN,SAAU,CACT,IAAOd,EAAU,IACjB,MAASA,EAAU,KACnB,EACD,QAAUiB,GAAc,CACvB,MAAMJ,EAAM,KAAK,MAAMI,EAAU,IAAI,EACrC,GAAIJ,EAAI,MAAQ,EAAG,CAClBD,EAAAA,MAAI,UAAU,CACb,KAAM,OACN,MAAOC,EAAI,IACnB,CAAQ,EACD,MACA,CACDD,EAAAA,MAAI,UAAU,CACb,KAAM,UACN,MAAO,MACd,CAAO,EACDR,EAAO,MAAQS,EAAI,KAAK,MACxB,CACN,CAAK,CACD,CACJ,CAAG,CACD,EAEKK,EAAY,IAAM,CACvBN,EAAAA,MAAI,aAAc,CAClB,EAEKO,EAAa,IAAM,CACxBb,EAAiB,MAAQ,EACzB,EAMKc,EAAe,IAAM,CAC1BC,oBAAkB,CACjB,IAAKrB,EAAU,IACf,MAAOA,EAAU,MACjB,SAAUU,EAAK,MACf,QAASN,EAAO,MAChB,gBAAiBK,EAAY,MAAM,CAAC,EACpC,YAAaA,EAAY,MAAM,CAAC,EAChC,YAAaA,EAAY,MAAM,CAAC,CACnC,CAAG,EAAE,KAAKI,GAAO,CACVA,EAAI,MAAQ,IACfD,EAAAA,MAAI,UAAU,CACb,KAAM,UACN,MAAO,MACZ,CAAK,EACD,WAAW,IAAM,CAChBA,EAAAA,MAAI,aAAc,CAClB,EAAE,GAAG,EAEV,CAAG,CACD,EAEKT,EAAc,IAAM,CACzBmB,cAAY,CACX,IAAKtB,EAAU,IACf,MAAOA,EAAU,KACpB,CAAG,EAAE,KAAKa,GAAO,CACdH,EAAK,MAAQG,EAAI,KAAK,SACtBT,EAAO,MAAQS,EAAI,KAAK,QACpBA,EAAI,KAAK,iBAAmB,KAC/BJ,EAAY,MAAM,CAAC,EAAII,EAAI,KAAK,gBAChCJ,EAAY,MAAM,CAAC,EAAII,EAAI,KAAK,YAChCJ,EAAY,MAAM,CAAC,EAAII,EAAI,KAAK,YAEpC,CAAG,CACD,2gBCtLF,GAAG,WAAWU,CAAe"}