{"version":3,"file":"windowAddress.js","sources":["pages/mineFunc/windowAddress.vue","../../HbuilderX/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcbWluZUZ1bmNcd2luZG93QWRkcmVzcy52dWU"],"sourcesContent":["<template>\r\n\t<image src=\"/static/task/taskBackground.png\" mode=\"aspectFit\" class=\"window-address-background\"></image>\r\n\t<view class=\"navigation-bar\">\r\n\t\t<view class=\"navgation-bar-content text-color\">\r\n\t\t\t<view style=\"position: absolute; left: 32rpx; top: 11rpx; z-index: 2;\"> <uv-icon name=\"arrow-left\"\r\n\t\t\t\t\tcolor=\"#fff\" @click=\"backPage\"></uv-icon></view>\r\n\t\t\t橱窗名称\r\n\t\t</view>\r\n\t</view>\r\n\t<view class=\"window-address-content center-box\">\r\n\t\t<view class=\"window-address-content-title\" style=\"margin-bottom: 32rpx; margin-top: 32rpx;\">\r\n\t\t\t<span style=\"color: #FF4343;\">*</span> 橱窗名称\r\n\t\t</view>\r\n\t\t<uv-input v-model=\"inputValue\" placeholder=\"请输入标题\" style=\"margin-top: 32rpx; font-weight: bold;\">\r\n\t\t\t<template v-slot:prefix>\r\n\t\t\t\t<uv-text text=\"【蚂蚁联盟】-\" margin=\"0 3px 0 0\" type=\"tips\"></uv-text>\r\n\t\t\t</template>\r\n\t\t</uv-input>\r\n\t</view>\r\n\t<view class=\"window-address-content center-box\" style=\"margin-top: 24rpx;\">\r\n\t\t<view class=\"window-address-content-title\" style=\"margin-bottom: 32rpx; margin-top: 32rpx;\">\r\n\t\t\t<span style=\"color: #FF4343;\">*</span> 视频号ID\r\n\t\t</view>\r\n\t\t<uv-input v-model=\"videoId\" placeholder=\"请输入视频号\" style=\"margin-top: 32rpx; font-weight: bold;\">\r\n\t\t</uv-input>\r\n\t</view>\r\n\t<view class=\"window-address-content center-box\" style=\"margin-top: 24rpx;\">\r\n\t\t<view class=\"window-address-content-title\" style=\"margin-bottom: 32rpx; margin-top: 32rpx;\">\r\n\t\t\t<span style=\"color: #FF4343;\">*</span> 手机号\r\n\t\t</view>\r\n\t\t<button open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\"\r\n\t\t\tstyle=\"font-size: 28rpx; text-align: left;\">{{phone == \"\" ? \"获取手机号\" : phone}}</button>\r\n\t\t<!-- \t\t<uv-input v-model=\"videoId\" placeholder=\"请输入视频号\" style=\"margin-top: 32rpx; font-weight: bold;\">\r\n\t\t</uv-input> -->\r\n\t</view>\r\n\t<view class=\"save-btn center-box\" @click=\"editUserInfo\">确认</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref\r\n\t} from 'vue';\r\n\r\n\tconst inputValue = ref(\"\")\r\n\tconst windowsCode = ref(\"\")\r\n\tconst videoId = ref(\"\")\r\n\tconst phone = ref(\"\")\r\n\timport {\r\n\t\tSERVERTAPI\r\n\t} from '../../config';\r\n\timport {\r\n\t\tuseUserStore\r\n\t} from '../../store/user';\r\n\timport {\r\n\t\tonShow,\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app'\r\n\timport {\r\n\t\tchangeUserInfoApi,\r\n\t\tuserInfoApi,\r\n\t\ttelnumberApi\r\n\t} from '../../request/api';\r\n\tconst userStore = useUserStore()\r\n\timport {\r\n\t\tupload\r\n\t} from '../../request/api'\r\n\tonLoad(() => {\r\n\t\tgetUserInfo()\r\n\t})\r\n\tconst uploadImage = () => {\r\n\t\tuni.chooseImage({\r\n\t\t\tcount: 1,\r\n\t\t\tsizeType: ['original', 'compressed'],\r\n\t\t\tsourceType: ['album', 'camera'],\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconst tempFilePaths = res.tempFilePaths[0];\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: SERVERTAPI + upload,\r\n\t\t\t\t\tfilePath: tempFilePaths,\r\n\t\t\t\t\tname: 'file',\r\n\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t'uid': userStore.uid,\r\n\t\t\t\t\t\t'token': userStore.token\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (uploadRes) => {\r\n\t\t\t\t\t\tconst res = JSON.parse(uploadRes.data)\r\n\t\t\t\t\t\tif (res.code != 1) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\ttitle: res.info\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\ttitle: '上传成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\twindowsCode.value = res.data.urlImg\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tconst editUserInfo = () => {\r\n\t\tif (inputValue.value == \"\" || videoId.value == \"\" || phone.value == \"\") {\r\n\t\t\tuni.showToast({\r\n\t\t\t\ticon: 'none',\r\n\t\t\t\ttitle: '请完整填写信息'\r\n\t\t\t})\r\n\t\t\treturn\r\n\t\t}\r\n\t\tchangeUserInfoApi({\r\n\t\t\tuid: userStore.uid,\r\n\t\t\ttoken: userStore.token,\r\n\t\t\twindow_goods_name: \"【蚂蚁联盟】\" + inputValue.value,\r\n\t\t\tvideo_account: videoId.value,\r\n\t\t\tphone: phone.value,\r\n\t\t}).then(res => {\r\n\t\t\tif (res.code == 1) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\ttitle: '修改成功'\r\n\t\t\t\t})\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t}, 500)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tconst getUserInfo = () => {\r\n\t\tuserInfoApi({\r\n\t\t\tuid: userStore.uid,\r\n\t\t\ttoken: userStore.token\r\n\t\t}).then(res => {\r\n\t\t\tinputValue.value = res.data.window_goods_name.replace(new RegExp(\"【蚂蚁联盟】\", 'g'), '');\r\n\t\t\twindowsCode.value = res.data.window_qr_code\r\n\t\t\tvideoId.value = res.data.video_account\r\n\t\t\tphone.value = res.data.phone\r\n\t\t})\r\n\t}\r\n\r\n\tconst getPhoneNumber = (e) => {\r\n\t\tif (e.detail.errMsg === 'getPhoneNumber:ok') {\r\n\t\t\tconst encryptedData = e.detail.encryptedData;\r\n\t\t\tconst iv = e.detail.iv;\r\n\t\t\tuni.login({\r\n\t\t\t\tsuccess: (loginRes) => {\r\n\t\t\t\t\tif (loginRes.code) {\r\n\t\t\t\t\t\ttelnumberApi({\r\n\t\t\t\t\t\t\tuid: userStore.uid,\r\n\t\t\t\t\t\t\tcode: loginRes.code,\r\n\t\t\t\t\t\t\tencryptedData: encryptedData,\r\n\t\t\t\t\t\t\tiv: iv\r\n\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\t\t\tphone.value = res.data\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 获取登录凭证失败\r\n\t\t\t\t\t\tconsole.error('获取登录凭证失败：', loginRes.errMsg);\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '获取登录凭证失败，请稍后重试',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t// 登录失败\r\n\t\t\t\t\tconsole.error('登录失败：', err);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '登录失败，请检查网络',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// 用户拒绝授权\r\n\t\t\tconsole.log('用户拒绝授权获取手机号');\r\n\t\t\tuni.showToast({\r\n\t\t\t\ttitle: '你拒绝了授权，无法获取手机号',\r\n\t\t\t\ticon: 'none'\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst backPage = () => {\r\n\t\tuni.navigateBack()\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.window-address-background {\r\n\t\ttop: -20rpx;\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 696rpx;\r\n\t}\r\n\r\n\t.navigation-bar {\r\n\t\tposition: relative;\r\n\t\tz-index: 1;\r\n\t\toverflow: hidden;\r\n\t\twidth: 100%;\r\n\t\theight: 440rpx;\r\n\r\n\t\t.navgation-bar-content {\r\n\t\t\tposition: relative;\r\n\t\t\tmargin-top: 88rpx;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 108rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\r\n\t\t.text-color {\r\n\t\t\tcolor: #FFFFFF;\r\n\t\t}\r\n\t}\r\n\r\n\t.window-address-content {\r\n\t\toverflow: hidden;\r\n\t\tposition: relative;\r\n\t\tz-index: 1;\r\n\t\tbox-sizing: border-box;\r\n\t\theight: 220rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tmargin-top: -240rpx;\r\n\t\tborder-radius: 8rpx 8rpx 8rpx 8rpx;\r\n\t\tpadding: 0 24rpx;\r\n\r\n\t\t.window-address-content-title {\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tcolor: #1A1A1A;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\t}\r\n\r\n\t.window-address-code {\r\n\t\tmargin-top: 24rpx;\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 8rpx 8rpx 8rpx 8rpx;\r\n\t\tpadding: 32rpx 24rpx;\r\n\r\n\t\t.window-address-code-title {\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tcolor: #1A1A1A;\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\r\n\t\t.upload-window-address-code {\r\n\t\t\tposition: relative;\r\n\t\t\tmargin-top: 32rpx;\r\n\t\t\twidth: 200rpx;\r\n\t\t\theight: 200rpx;\r\n\t\t\tbackground-color: #F6F6F6;\r\n\t\t\tborder-radius: 16rpx 16rpx 16rpx 16rpx;\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.save-btn {\r\n\t\tmargin-top: 48rpx;\r\n\t\theight: 96rpx;\r\n\t\ttext-align: center;\r\n\t\tline-height: 96rpx;\r\n\t\tborder-radius: 60rpx 60rpx 60rpx 60rpx;\r\n\t\tbackground-color: #FAA82C;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #FFFFFF;\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/work/达人h5/pages/mineFunc/windowAddress.vue'\nwx.createPage(MiniProgramPage)"],"names":["inputValue","ref","windowsCode","videoId","phone","userStore","useUserStore","onLoad","getUserInfo","editUserInfo","uni","changeUserInfoApi","res","userInfoApi","getPhoneNumber","e","encryptedData","iv","loginRes","telnumberApi","err","backPage","MiniProgramPage"],"mappings":"4hBA2CC,MAAMA,EAAaC,EAAG,IAAC,EAAE,EACnBC,EAAcD,EAAG,IAAC,EAAE,EACpBE,EAAUF,EAAG,IAAC,EAAE,EAChBG,EAAQH,EAAG,IAAC,EAAE,EAgBdI,EAAYC,EAAAA,aAAc,EAIhCC,EAAAA,OAAO,IAAM,CACZC,EAAa,CACf,CAAE,EAoCD,MAAMC,EAAe,IAAM,CAC1B,GAAIT,EAAW,OAAS,IAAMG,EAAQ,OAAS,IAAMC,EAAM,OAAS,GAAI,CACvEM,EAAAA,MAAI,UAAU,CACb,KAAM,OACN,MAAO,SACX,CAAI,EACD,MACA,CACDC,oBAAkB,CACjB,IAAKN,EAAU,IACf,MAAOA,EAAU,MACjB,kBAAmB,SAAWL,EAAW,MACzC,cAAeG,EAAQ,MACvB,MAAOC,EAAM,KAChB,CAAG,EAAE,KAAKQ,GAAO,CACVA,EAAI,MAAQ,IACfF,EAAAA,MAAI,UAAU,CACb,KAAM,UACN,MAAO,MACZ,CAAK,EACD,WAAW,IAAM,CAChBA,EAAAA,MAAI,aAAc,CAClB,EAAE,GAAG,EAEV,CAAG,CACD,EAEKF,EAAc,IAAM,CACzBK,cAAY,CACX,IAAKR,EAAU,IACf,MAAOA,EAAU,KACpB,CAAG,EAAE,KAAKO,GAAO,CACdZ,EAAW,MAAQY,EAAI,KAAK,kBAAkB,QAAQ,IAAI,OAAO,SAAU,GAAG,EAAG,EAAE,EACnFV,EAAY,MAAQU,EAAI,KAAK,eAC7BT,EAAQ,MAAQS,EAAI,KAAK,cACzBR,EAAM,MAAQQ,EAAI,KAAK,KAC1B,CAAG,CACD,EAEKE,EAAkBC,GAAM,CAC7B,GAAIA,EAAE,OAAO,SAAW,oBAAqB,CAC5C,MAAMC,EAAgBD,EAAE,OAAO,cACzBE,EAAKF,EAAE,OAAO,GACpBL,EAAAA,MAAI,MAAM,CACT,QAAUQ,GAAa,CAClBA,EAAS,KACZC,eAAa,CACZ,IAAKd,EAAU,IACf,KAAMa,EAAS,KACf,cAAeF,EACf,GAAIC,CACX,CAAO,EAAE,KAAKL,GAAO,CACdF,EAAAA,MAAY,MAAA,MAAA,0CAAAE,CAAG,EACfR,EAAM,MAAQQ,EAAI,IACzB,CAAO,GAGDF,gEAAc,YAAaQ,EAAS,MAAM,EAC1CR,EAAAA,MAAI,UAAU,CACb,MAAO,iBACP,KAAM,MACb,CAAO,EAEF,EACD,KAAOU,GAAQ,CAEdV,EAAc,MAAA,MAAA,QAAA,0CAAA,QAASU,CAAG,EAC1BV,EAAAA,MAAI,UAAU,CACb,MAAO,aACP,KAAM,MACZ,CAAM,CACD,CACL,CAAI,CACJ,MAEGA,EAAAA,MAAA,MAAA,MAAA,0CAAY,aAAa,EACzBA,EAAAA,MAAI,UAAU,CACb,MAAO,iBACP,KAAM,MACV,CAAI,CAEF,EAEKW,EAAW,IAAM,CACtBX,EAAAA,MAAI,aAAc,CAClB,iYC5LF,GAAG,WAAWY,CAAe"}